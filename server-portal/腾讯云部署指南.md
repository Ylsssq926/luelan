# 腾讯云服务器部署指南

## 当前状态
- ✅ 项目构建完成：`server-portal/dist/` 目录已生成
- ✅ 构建文件：index.html, assets/ 等静态资源
- 🔄 等待部署到腾讯云服务器

## 部署步骤

### 第一步：上传文件到腾讯云服务器

1. **使用SCP命令上传文件**（在本地PowerShell执行）：
```powershell
# 上传整个dist目录到服务器
scp -r .\dist\ 用户名@服务器IP:/var/www/luelan.online/main-site/

# 示例（替换为您的实际信息）：
scp -r .\dist\ root@您的服务器IP:/var/www/luelan.online/main-site/
```

2. **或者使用WinSCP图形化工具**：
   - 下载安装WinSCP
   - 连接服务器：SFTP协议，端口22
   - 将本地dist目录拖拽到服务器 `/var/www/luelan.online/main-site/` 目录

### 第二步：配置Nginx

1. **登录服务器**：
```bash
ssh root@您的服务器IP
```

2. **创建Nginx配置文件**：
```bash
# 创建站点配置文件
nano /etc/nginx/conf.d/luelan.online.conf
```

3. **配置内容**：
```nginx
server {
    listen 80;
    server_name luelan.online www.luelan.online;
    
    # 主站根目录
    root /var/www/luelan.online/main-site/dist;
    index index.html;
    
    # 单页应用路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 禁止访问隐藏文件
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}
```

### 第三步：设置文件权限

```bash
# 设置nginx用户权限
chown -R nginx:nginx /var/www/luelan.online/
chmod -R 755 /var/www/luelan.online/

# 检查权限
ls -la /var/www/luelan.online/main-site/dist/
```

### 第四步：测试并重启Nginx

```bash
# 测试Nginx配置
nginx -t

# 重启Nginx服务
systemctl restart nginx

# 检查服务状态
systemctl status nginx
```

### 第五步：验证部署

1. 访问网站：http://luelan.online
2. 检查控制台无错误
3. 测试页面路由是否正常

## 故障排除

### 常见问题1：403 Forbidden
```bash
# 检查文件权限
ls -la /var/www/luelan.online/main-site/dist/index.html

# 修复权限
chmod 644 /var/www/luelan.online/main-site/dist/*
```

### 常见问题2：Nginx配置错误
```bash
# 查看错误日志
tail -f /var/log/nginx/error.log

# 重新加载配置
nginx -s reload
```

### 常见问题3：文件不存在
```bash
# 检查文件是否存在
ls -la /var/www/luelan.online/main-site/dist/

# 重新上传文件
```

## 自动化部署脚本

创建部署脚本 `deploy.sh`：
```bash
#!/bin/bash
echo "开始部署主站项目..."

# 停止Nginx
systemctl stop nginx

# 备份旧文件
cp -r /var/www/luelan.online/main-site/dist /var/www/luelan.online/main-site/dist.backup.$(date +%Y%m%d%H%M%S)

# 上传新文件（需要提前上传）
# scp操作...

# 设置权限
chown -R nginx:nginx /var/www/luelan.online/
chmod -R 755 /var/www/luelan.online/

# 启动Nginx
systemctl start nginx

echo "部署完成！"
```

## 后续维护

1. **定期备份**：重要更新前备份dist目录
2. **监控日志**：定期检查Nginx访问日志和错误日志
3. **SSL证书**：考虑添加HTTPS支持

## 联系方式
如有问题，请参考此文档或联系技术支持。